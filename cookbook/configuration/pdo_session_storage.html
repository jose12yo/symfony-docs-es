
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cómo utilizar PdoSessionStorage para almacenar sesiones en la base de datos &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="top" title="Manual de Symfony2 en Español" href="../../index.html" />
    <link rel="up" title="Recetario" href="../index.html" />
    <link rel="next" title="Estructura de un paquete y buenas prácticas" href="../bundles/best_practices.html" />
    <link rel="prev" title="Cómo trabajar con ámbitos" href="../service_container/scopes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../bundles/best_practices.html" title="Estructura de un paquete y buenas prácticas"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../service_container/scopes.html" title="Cómo trabajar con ámbitos"
             accesskey="P">anterior</a> |</li>
        <li><a href="../../index.html">Symfony2</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Recetario</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="como-utilizar-pdosessionstorage-para-almacenar-sesiones-en-la-base-de-datos">
<span id="index-0"></span><h1>Cómo utilizar <tt class="docutils literal"><span class="pre">PdoSessionStorage</span></tt> para almacenar sesiones en la base de datos<a class="headerlink" href="#como-utilizar-pdosessionstorage-para-almacenar-sesiones-en-la-base-de-datos" title="Enlazar permanentemente con este título">¶</a></h1>
<p>El almacenamiento de sesiones predeterminado de <em>Symfony2</em> escribe la información de la sesión en archivo(s). La mayoría de medianos a grandes sitios web utilizan una base de datos para almacenar valores de sesión en lugar de archivos, porque las bases de datos son más fáciles de usar y escalar en un entorno multiservidor web.</p>
<p><em>Symfony2</em> ha incorporado una solución de almacenamiento en base de datos denominada <tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\SessionStorage\PdoSessionStorage</span></tt>.
Para usarla, sólo tienes que cambiar algunos parámetros en <tt class="docutils literal"><span class="pre">config.yml</span></tt> (o el formato de configuración de tu elección):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><pre># app/config/config.yml
framework:
    session:
        # ...
        storage_id:     session.storage.pdo

parameters:
    pdo.db_options:
        db_table:    session
        db_id_col:   session_id
        db_data_col: session_value
        db_time_col: session_time

services:
    pdo:
        class: PDO
        arguments:
            dsn:      "mysql:dbname=mydatabase"
            user:     myuser
            password: mypassword

    session.storage.pdo:
        class:     Symfony\Component\HttpFoundation\SessionStorage\PdoSessionStorage
        arguments: [@pdo, %session.storage.options%, %pdo.db_options%]</pre>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;framework:config&gt;</span>
    <span class="nt">&lt;framework:session</span> <span class="na">storage-id=</span><span class="s">&quot;session.storage.pdo&quot;</span> <span class="na">lifetime=</span><span class="s">&quot;3600&quot;</span> <span class="na">auto-start=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/framework:config&gt;</span>

<span class="nt">&lt;parameters&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;pdo.db_options&quot;</span> <span class="na">type=</span><span class="s">&quot;collection&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;db_table&quot;</span><span class="nt">&gt;</span>session<span class="nt">&lt;/parameter&gt;</span>
        <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;db_id_col&quot;</span><span class="nt">&gt;</span>session_id<span class="nt">&lt;/parameter&gt;</span>
        <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;db_data_col&quot;</span><span class="nt">&gt;</span>session_value<span class="nt">&lt;/parameter&gt;</span>
        <span class="nt">&lt;parameter</span> <span class="na">key=</span><span class="s">&quot;db_time_col&quot;</span><span class="nt">&gt;</span>session_time<span class="nt">&lt;/parameter&gt;</span>
    <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/parameters&gt;</span>

<span class="nt">&lt;services&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;pdo&quot;</span> <span class="na">class=</span><span class="s">&quot;PDO&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;argument&gt;</span>mysql:dbname=mydatabase<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;argument&gt;</span>myuser<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;argument&gt;</span>mypassword<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/service&gt;</span>

    <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;session.storage.pdo&quot;</span> <span class="na">class=</span><span class="s">&quot;Symfony\Component\HttpFoundation\SessionStorage\PdoSessionStorage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;service&quot;</span> <span class="na">id=</span><span class="s">&quot;pdo&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;argument&gt;</span>%session.storage.options%<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;argument&gt;</span>%pdo.db_options%<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/services&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// app/config/config.yml</span>
<span class="x">use Symfony\Component\DependencyInjection\Definition;</span>
<span class="x">use Symfony\Component\DependencyInjection\Reference;</span>

<span class="x">$container-&gt;loadFromExtension(&#39;framework&#39;, array(</span>
<span class="x">    // ...</span>
<span class="x">    &#39;session&#39; =&gt; array(</span>
<span class="x">        // ...</span>
<span class="x">        &#39;storage_id&#39; =&gt; &#39;session.storage.pdo&#39;,</span>
<span class="x">    ),</span>
<span class="x">));</span>

<span class="x">$container-&gt;setParameter(&#39;pdo.db_options&#39;, array(</span>
<span class="x">    &#39;db_table&#39;      =&gt; &#39;session&#39;,</span>
<span class="x">    &#39;db_id_col&#39;     =&gt; &#39;session_id&#39;,</span>
<span class="x">    &#39;db_data_col&#39;   =&gt; &#39;session_value&#39;,</span>
<span class="x">    &#39;db_time_col&#39;   =&gt; &#39;session_time&#39;,</span>
<span class="x">));</span>

<span class="x">$pdoDefinition = new Definition(&#39;PDO&#39;, array(</span>
<span class="x">    &#39;mysql:dbname=mydatabase&#39;,</span>
<span class="x">    &#39;myuser&#39;,</span>
<span class="x">    &#39;mypassword&#39;,</span>
<span class="x">));</span>
<span class="x">$container-&gt;setDefinition(&#39;pdo&#39;, $pdoDefinition);</span>

<span class="x">$storageDefinition = new Definition(&#39;Symfony\Component\HttpFoundation\SessionStorage\PdoSessionStorage&#39;, array(</span>
<span class="x">    new Reference(&#39;pdo&#39;),</span>
<span class="x">    &#39;%session.storage.options%&#39;,</span>
<span class="x">    &#39;%pdo.db_options%&#39;,</span>
<span class="x">));</span>
<span class="x">$container-&gt;setDefinition(&#39;session.storage.pdo&#39;, $storageDefinition);</span>
</pre></div>
</div>
</li>
</ul>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">db_table</span></tt>: El nombre de la tabla de sesiones en tu base de datos</li>
<li><tt class="docutils literal"><span class="pre">db_id_col</span></tt>: El nombre de la columna <tt class="docutils literal"><span class="pre">id</span></tt> en la tabla de sesiones (<tt class="docutils literal"><span class="pre">VARCHAR</span> <span class="pre">(255)</span></tt> o más grande)</li>
<li><tt class="docutils literal"><span class="pre">db_data_col</span></tt>: El nombre de la columna de valores en tu tabla de sesiones (<tt class="docutils literal"><span class="pre">TEXT</span></tt> o <tt class="docutils literal"><span class="pre">CLOB</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">db_time_col</span></tt>: El nombre de la columna de tiempo en tu tabla de sesiones (<tt class="docutils literal"><span class="pre">INTEGER</span></tt>)</li>
</ul>
<div class="section" id="compartiendo-informacion-de-conexion-a-tu-base-de-datos">
<h2>Compartiendo información de conexión a tu base de datos<a class="headerlink" href="#compartiendo-informacion-de-conexion-a-tu-base-de-datos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Con la configuración dada, la configuración de conexión de la base de datos únicamente se define para la conexión de almacenamiento de sesión. Esto está bien cuando utilizas una base de datos para los datos de sesión.</p>
<p>Pero si deseas almacenar los datos de sesión en la misma base que el resto de los datos de tu proyecto, puedes utilizar la configuración de conexión de <tt class="docutils literal"><span class="pre">parameters.yml</span></tt> refiriendo los parámetros relacionados con la base de datos definidos allí:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><pre>pdo:
    class: PDO
    arguments:
        - "mysql:dbname=%database_name%"
        - %database_user%
        - %database_password%</pre>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;pdo&quot;</span> <span class="na">class=</span><span class="s">&quot;PDO&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;argument&gt;</span>mysql:dbname=%database_name%<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;argument&gt;</span>%database_user%<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;argument&gt;</span>%database_password%<span class="nt">&lt;/argument&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre>$pdoDefinition = new Definition(&#39;PDO&#39;, array(
    &#39;mysql:dbname=%database_name%&#39;,
    &#39;%database_user%&#39;,
    &#39;%database_password%&#39;,
));
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="ejemplo-de-instrucciones-sql">
<h2>Ejemplo de instrucciones <em>SQL</em><a class="headerlink" href="#ejemplo-de-instrucciones-sql" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="mysql">
<h3><em>MySQL</em><a class="headerlink" href="#mysql" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La declaración <em>SQL</em> necesaria para crear la tabla en la base de datos podría ser similar a la siguiente (<em>MySQL</em>):</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="k">session</span><span class="o">`</span> <span class="p">(</span>
    <span class="o">`</span><span class="n">session_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="o">`</span><span class="n">session_value</span><span class="o">`</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="o">`</span><span class="n">session_time</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">session_id</span><span class="o">`</span><span class="p">),</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="postgresql">
<h3><em>PostgreSQL</em><a class="headerlink" href="#postgresql" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para <em>PostgreSQL</em>, la declaración debe tener este aspecto:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">session</span> <span class="p">(</span>
    <span class="n">session_id</span> <span class="nb">character</span> <span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">session_value</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">session_time</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">session_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">session_id</span><span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cómo utilizar <tt class="docutils literal"><span class="pre">PdoSessionStorage</span></tt> para almacenar sesiones en la base de datos</a><ul>
<li><a class="reference internal" href="#compartiendo-informacion-de-conexion-a-tu-base-de-datos">Compartiendo información de conexión a tu base de datos</a></li>
<li><a class="reference internal" href="#ejemplo-de-instrucciones-sql">Ejemplo de instrucciones <em>SQL</em></a><ul>
<li><a class="reference internal" href="#mysql"><em>MySQL</em></a></li>
<li><a class="reference internal" href="#postgresql"><em>PostgreSQL</em></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="../service_container/scopes.html"
                        title="Capítulo anterior">Cómo trabajar con ámbitos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../bundles/best_practices.html"
                        title="Próximo capítulo">Estructura de un paquete y buenas prácticas</a></p>
<div id="searchbox" style="display: none">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../bundles/best_practices.html" title="Estructura de un paquete y buenas prácticas"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../service_container/scopes.html" title="Cómo trabajar con ámbitos"
             >anterior</a> |</li>
        <li><a href="../../index.html">Symfony2</a> &raquo;</li>
          <li><a href="../index.html" >Recetario</a> &raquo;</li> 
      </ul>
    </div>
   <div id="disqus_thread"></div>
   
    <div class="footer">
        &copy; Copyright 2011, Traducido por Nacho Pacheco.
      Actualizado por última vez en Dec 07, 2011.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
   <script type="text/javascript"> 
    var disqus_shortname = 'documentos-mx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script> 
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>